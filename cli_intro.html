<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="_static/javascripts/modernizr.js"></script>
  
  
  
    <title>simeon &#8212; simeon  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=83e35b93" />
    <link rel="stylesheet" type="text/css" href="_static/material.css?v=79c92029" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Components of the download package" href="api_intro.html" />
    <link rel="prev" title="Documentation for the simeon CLI tool" href="index.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=blue data-md-color-accent=light-blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#cli_intro" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="index.html" title="simeon  documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">simeon</span>
          <span class="md-header-nav__topic"> simeon </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder=""Search""
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/MIT-IR/simeon/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    simeon
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = ""versions.json"",
        target_loc = "../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">simeon  documentation</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="index.html" title="simeon documentation" class="md-nav__button md-logo">
      
        <img src="_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="index.html"
       title="simeon documentation">simeon</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/MIT-IR/simeon/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    simeon
  </div>
</a>
    </div>
  
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#cli-intro--page-root" class="md-nav__link">simeon</a>
        </li>
        <li class="md-nav__item"><a href="#installing-from-pypi" class="md-nav__link">Installing from pypi</a>
        </li>
        <li class="md-nav__item"><a href="#installing-with-git-clone-and-pip" class="md-nav__link">Installing with git clone and pip</a>
        </li>
        <li class="md-nav__item"><a href="#using-docker" class="md-nav__link">Using Docker</a>
        </li>
        <li class="md-nav__item"><a href="#developing" class="md-nav__link">Developing</a>
        </li>
        <li class="md-nav__item"><a href="#setups-and-configurations" class="md-nav__link">Setups and configurations</a>
        </li>
        <li class="md-nav__item"><a href="#list-files" class="md-nav__link">List files</a>
        </li>
        <li class="md-nav__item"><a href="#download-and-split-files" class="md-nav__link">Download and split files</a>
        </li>
        <li class="md-nav__item"><a href="#make-secondary-aggregated-tables" class="md-nav__link">Make secondary/aggregated tables</a>
        </li>
        <li class="md-nav__item"><a href="#notes" class="md-nav__link">Notes:</a>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="_sources/cli_intro.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="simeon">
<h1 id="cli-intro--page-root">simeon<a class="headerlink" href="#cli-intro--page-root" title="Link to this heading">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">simeon</span></code> is a CLI tool to help with the processing of edx Research
data. It can <code class="docutils literal notranslate"><span class="pre">list</span></code>, <code class="docutils literal notranslate"><span class="pre">download</span></code>, and <code class="docutils literal notranslate"><span class="pre">split</span></code> edX data packages. It
can also <code class="docutils literal notranslate"><span class="pre">push</span></code> the output of the <code class="docutils literal notranslate"><span class="pre">split</span></code> subcommand to both GCS and
BigQuery. It is heavily inspired by the
<a class="reference external" href="https://github.com/mitodl/edx2bigquery">edx2bigquery</a> package. If
you’ve used that tool, you should be able to navigate the quirks that
may come with this one.</p>
</section>
<section id="installing-from-pypi">
<h1 id="installing-from-pypi">Installing from pypi<a class="headerlink" href="#installing-from-pypi" title="Link to this heading">¶</a></h1>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>simeon
<span class="c1"># Or with geoip</span>
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>simeon<span class="o">[</span>geoip<span class="o">]</span>
<span class="c1"># Then invoke the CLI tool with</span>
simeon<span class="w"> </span>--help
</pre></div>
</div>
</section>
<section id="installing-with-git-clone-and-pip">
<h1 id="installing-with-git-clone-and-pip">Installing with git clone and pip<a class="headerlink" href="#installing-with-git-clone-and-pip" title="Link to this heading">¶</a></h1>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:MIT-IR/simeon.git
<span class="nb">cd</span><span class="w"> </span>simeon<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">source</span><span class="w"> </span>venv/bin/activate<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>.
<span class="c1"># Or with geoip</span>
<span class="nb">cd</span><span class="w"> </span>simeon<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">source</span><span class="w"> </span>venv/bin/activate<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">  </span>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>.<span class="o">[</span>geoip<span class="o">]</span>
<span class="c1"># Then invoke the CLI tool with</span>
simeon<span class="w"> </span>--help
</pre></div>
</div>
</section>
<section id="using-docker">
<h1 id="using-docker">Using Docker<a class="headerlink" href="#using-docker" title="Link to this heading">¶</a></h1>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-it<span class="w"> </span>mitir/simeon:latest
simeon<span class="w"> </span>--help
</pre></div>
</div>
</section>
<section id="developing">
<h1 id="developing">Developing<a class="headerlink" href="#developing" title="Link to this heading">¶</a></h1>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:MIT-IR/simeon.git
<span class="nb">cd</span><span class="w"> </span>simeon
<span class="c1"># Set up a virtual environment if you don't already have on</span>
python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
<span class="nb">source</span><span class="w"> </span>venv/bin/activate
<span class="c1"># pip install the package in an editable way</span>
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.<span class="o">[</span>test,geoip<span class="o">]</span>
<span class="c1"># Invoke the executable</span>
simeon<span class="w"> </span>--help
<span class="c1"># Run the tests</span>
tox
<span class="c1"># Write code and tests and submit PR's</span>
</pre></div>
</div>
</section>
<section id="setups-and-configurations">
<h1 id="setups-and-configurations">Setups and configurations<a class="headerlink" href="#setups-and-configurations" title="Link to this heading">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">simeon</span></code> is a glorified downloader and uploader set of scripts. Much
of the downloading and uploading that it does make the assumptions that
you have your AWS credentials configured properly and that you’ve got a
service account file for GCP services available on your machine. If the
latter is missing, you may have to authenticate to GCP services through
the SDK. However, both we and Google recommend you not do that.</p>
<p>Every downloaded file is decrypted either during the download process or
while it gets split by the <code class="docutils literal notranslate"><span class="pre">simeon</span> <span class="pre">split</span></code> command. So, this tool
assumes that you’ve installed and configured <code class="docutils literal notranslate"><span class="pre">gpg</span></code> to be able to
decrypt files from edX.</p>
<p>The following steps may be useful to someone just getting started with
the edX data package:</p>
<ol class="arabic simple">
<li><p>Credentials from edX</p>
<ul class="simple">
<li><p>Reach out to edX to get your data czar credentials</p></li>
<li><p>Configure both AWS and gpg, so your credentials can access the S3
buckets and your <code class="docutils literal notranslate"><span class="pre">gpg</span></code> key can decrypt the files there</p></li>
</ul>
</li>
<li><p>Setup a GCP project</p>
<ul class="simple">
<li><p>Create a GCP project</p></li>
<li><p>Set up a BigQuery workspace</p></li>
<li><p>Create a GCS bucket</p></li>
<li><p>Create a service account and download the associated file</p></li>
<li><p>Give the service account Admin Role access to both the BigQuery
project and the GCS bucket</p></li>
</ul>
</li>
</ol>
<p>If the above steps are carried out successfully, then you should be able
to use <code class="docutils literal notranslate"><span class="pre">simeon</span></code> without any issues.</p>
<p>However, if you’ve taken care of the above steps but are still unable to
get <code class="docutils literal notranslate"><span class="pre">simeon</span></code> to work, please open an issue.</p>
<p>Further, <code class="docutils literal notranslate"><span class="pre">simeon</span></code> can parse INI formatted configuration files. It, by
default, looks for files in the user’s home directory, or in the current
working directory of the running process. The base names that are
targeted when config files are looked up are: <code class="docutils literal notranslate"><span class="pre">simeon.cfg</span></code> or
<code class="docutils literal notranslate"><span class="pre">.simeon.cfg</span></code> or <code class="docutils literal notranslate"><span class="pre">simeon.ini</span></code> or <code class="docutils literal notranslate"><span class="pre">.simeon.ini</span></code>. You can also
provide <code class="docutils literal notranslate"><span class="pre">simeon</span></code> with a config file by using the global option
<code class="docutils literal notranslate"><span class="pre">--config-file</span></code> or <code class="docutils literal notranslate"><span class="pre">-C</span></code> and giving it a path to the file with the
corresponding configurations.</p>
<p>The following is a sample file content:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Default section for things like the organization whose data package is processed</span>
<span class="c1"># You can also set a default site as one of the following: edx, edge, patches</span>
<span class="o">[</span>DEFAULT<span class="o">]</span>
<span class="nv">site</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>edx
<span class="nv">org</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>yourorganizationx
<span class="nv">clistings_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/path/to/file/with/course_ids

<span class="c1"># Section related to Google Cloud (project, bucket, service account)</span>
<span class="o">[</span>GCP<span class="o">]</span>
<span class="nv">project</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>your-gcp-project-id
<span class="nv">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>your-gcs-bucket
<span class="nv">service_account_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/path/to/a/service_account_file.json
<span class="nv">wait_for_loads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>True
<span class="nv">geo_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>your-gcp-project.geocode_latest.geoip
<span class="nv">youtube_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>your-gcp-project.videos.youtube
<span class="nv">youtube_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>your-YouTube-API-token

<span class="c1"># Section related to the AWS credentials needed to download data from S3</span>
<span class="o">[</span>AWS<span class="o">]</span>
<span class="nv">aws_cred_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>~/.aws/credentials
<span class="nv">profile_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>default
</pre></div>
</div>
<p>The options in the config file(s) should match the optional arguments of
the CLI tool. For instance, the <code class="docutils literal notranslate"><span class="pre">--service-account-file</span></code>,
<code class="docutils literal notranslate"><span class="pre">--project</span></code> and <code class="docutils literal notranslate"><span class="pre">--bucket</span></code> options can be provided under the <code class="docutils literal notranslate"><span class="pre">GCP</span></code>
section of the config file as <code class="docutils literal notranslate"><span class="pre">service_account_file</span></code>, <code class="docutils literal notranslate"><span class="pre">project</span></code> and
<code class="docutils literal notranslate"><span class="pre">bucket</span></code>, respectively. Similarly, the <code class="docutils literal notranslate"><span class="pre">--site</span></code> and <code class="docutils literal notranslate"><span class="pre">--org</span></code>
options can be provided under the <code class="docutils literal notranslate"><span class="pre">DEFAULT</span></code> section as <code class="docutils literal notranslate"><span class="pre">site</span></code> and
<code class="docutils literal notranslate"><span class="pre">org</span></code>, respectively.</p>
</section>
<section id="list-files">
<h1 id="list-files">List files<a class="headerlink" href="#list-files" title="Link to this heading">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">simeon</span></code> can list files on S3 for your organization based on criteria
like file type (<code class="docutils literal notranslate"><span class="pre">sql</span></code> or <code class="docutils literal notranslate"><span class="pre">log</span></code> or <code class="docutils literal notranslate"><span class="pre">email</span></code>), time intervals (begin
and end dates), and site (<code class="docutils literal notranslate"><span class="pre">edx</span></code> or <code class="docutils literal notranslate"><span class="pre">edge</span></code> or <code class="docutils literal notranslate"><span class="pre">patches</span></code>).</p>
<ul>
<li><p>Example: List the latest data packages for file types <code class="docutils literal notranslate"><span class="pre">sql</span></code>,
<code class="docutils literal notranslate"><span class="pre">email</span></code>, and <code class="docutils literal notranslate"><span class="pre">log</span></code></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># List the latest SQL bundle</span>
simeon<span class="w"> </span>list<span class="w"> </span>-s<span class="w"> </span>edx<span class="w"> </span>-o<span class="w"> </span>mitx<span class="w"> </span>-f<span class="w"> </span>sql<span class="w"> </span>-L
<span class="c1"># List the latest email data dump</span>
simeon<span class="w"> </span>list<span class="w"> </span>-s<span class="w"> </span>edx<span class="w"> </span>-o<span class="w"> </span>mitx<span class="w"> </span>-f<span class="w"> </span>email<span class="w"> </span>-L
<span class="c1"># List the latest tracking log file</span>
simeon<span class="w"> </span>list<span class="w"> </span>-s<span class="w"> </span>edx<span class="w"> </span>-o<span class="w"> </span>mitx<span class="w"> </span>-f<span class="w"> </span>log<span class="w"> </span>-L
</pre></div>
</div>
</li>
</ul>
</section>
<section id="download-and-split-files">
<h1 id="download-and-split-files">Download and split files<a class="headerlink" href="#download-and-split-files" title="Link to this heading">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">simeon</span></code> can download, decrypt and split up files into folders
belonging to specific courses.</p>
<ul>
<li><p>Example 1: Download, split and push SQL bundles to both GCS and
BigQuery</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download the latest SQL bundle</span>
simeon<span class="w"> </span>download<span class="w"> </span>-s<span class="w"> </span>edx<span class="w"> </span>-o<span class="w"> </span>mitx<span class="w"> </span>-f<span class="w"> </span>sql<span class="w"> </span>-L<span class="w"> </span>-d<span class="w"> </span>data/

<span class="c1"># Download SQL bundles dumped any time since 2021-01-01 and</span>
<span class="c1"># extract the contents for course ID MITx/12.3x/1T2021.</span>
<span class="c1"># Place the downloaded files in data/ and the output of the split operation</span>
<span class="c1"># in data/SQL</span>
simeon<span class="w"> </span>download<span class="w"> </span>-s<span class="w"> </span>edx<span class="w"> </span>-o<span class="w"> </span>mitx<span class="w"> </span>-c<span class="w"> </span><span class="s2">"MITx/12.3x/1T2021"</span><span class="w"> </span>-f<span class="w"> </span>sql<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-b<span class="w"> </span><span class="m">2021</span>-01-01<span class="w"> </span>-d<span class="w"> </span>data<span class="w"> </span>-S<span class="w"> </span>-D<span class="w"> </span>data/SQL/

<span class="c1"># Push to GCS the split up SQL files inside data/SQL/MITx__12_3x__1T2021</span>
simeon<span class="w"> </span>push<span class="w"> </span>gcs<span class="w"> </span>-f<span class="w"> </span>sql<span class="w"> </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">GCP_PROJECT_ID</span><span class="si">}</span><span class="w"> </span>-b<span class="w"> </span><span class="si">${</span><span class="nv">GCS_BUCKET</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-S<span class="w"> </span><span class="si">${</span><span class="nv">SAFILE</span><span class="si">}</span><span class="w"> </span>data/SQL/MITx__12_3x__1T2021

<span class="c1"># Push the files to BigQuery and wait for the jobs to finish</span>
<span class="c1"># Using -s or --use-storage tells BigQuery to extract the files</span>
<span class="c1"># to be loaded from Google Cloud Storage.</span>
<span class="c1"># So, use the option when you've already called simeon push gcs</span>
simeon<span class="w"> </span>push<span class="w"> </span>bq<span class="w"> </span>-w<span class="w"> </span>-s<span class="w"> </span>-f<span class="w"> </span>sql<span class="w"> </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">GCP_PROJECT_ID</span><span class="si">}</span><span class="w"> </span>-b<span class="w"> </span><span class="si">${</span><span class="nv">GCS_BUCKET</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-S<span class="w"> </span><span class="si">${</span><span class="nv">SAFILE</span><span class="si">}</span><span class="w"> </span>data/SQL/MITx__12_3x__1T2021
</pre></div>
</div>
</li>
<li><p>Example 2: Download, split and push tracking logs to both GCS and
BigQuery</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download the latest tracking log file</span>
simeon<span class="w"> </span>download<span class="w"> </span>-s<span class="w"> </span>edx<span class="w"> </span>-o<span class="w"> </span>mitx<span class="w"> </span>-f<span class="w"> </span>log<span class="w"> </span>-L<span class="w"> </span>-d<span class="w"> </span>data/

<span class="c1"># Download tracking logs dumped any time since 2021-01-01</span>
<span class="c1"># and extract the contents for course ID MITx/12.3x/1T2021</span>
<span class="c1"># Place the downloaded files in data/ and the output of the split operation</span>
<span class="c1"># in data/TRACKING_LOGS</span>
simeon<span class="w"> </span>download<span class="w"> </span>-s<span class="w"> </span>edx<span class="w"> </span>-o<span class="w"> </span>mitx<span class="w"> </span>-c<span class="w"> </span><span class="s2">"MITx/12.3x/1T2021"</span><span class="w"> </span>-f<span class="w"> </span>log<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-b<span class="w"> </span><span class="m">2021</span>-01-01<span class="w"> </span>-d<span class="w"> </span>data<span class="w"> </span>-S<span class="w"> </span>-D<span class="w"> </span>data/TRACKING_LOGS/

<span class="c1"># Push to GCS the split up tracking log files inside</span>
<span class="c1"># data/TRACKING_LOGS/MITx__12_3x__1T2021</span>
simeon<span class="w"> </span>push<span class="w"> </span>gcs<span class="w"> </span>-f<span class="w"> </span>log<span class="w"> </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">GCP_PROJECT_ID</span><span class="si">}</span><span class="w"> </span>-b<span class="w"> </span><span class="si">${</span><span class="nv">GCS_BUCKET</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-S<span class="w"> </span><span class="si">${</span><span class="nv">SAFILE</span><span class="si">}</span><span class="w"> </span>data/TRACKING_LOGS/MITx__12_3x__1T2021

<span class="c1"># Push the files to BigQuery and wait for the jobs to finish</span>
<span class="c1"># Using -s or --use-storage tells BigQuery to extract the files</span>
<span class="c1"># to be loaded from Google Cloud Storage.</span>
<span class="c1"># So, use the option when you've already called simeon push gcs</span>
simeon<span class="w"> </span>push<span class="w"> </span>bq<span class="w"> </span>-w<span class="w"> </span>-s<span class="w"> </span>-f<span class="w"> </span>log<span class="w"> </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">GCP_PROJECT_ID</span><span class="si">}</span><span class="w"> </span>-b<span class="w"> </span><span class="si">${</span><span class="nv">GCS_BUCKET</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-S<span class="w"> </span><span class="si">${</span><span class="nv">SAFILE</span><span class="si">}</span><span class="w"> </span>data/TRACKING_LOGS/MITx__12_3x__1T2021
</pre></div>
</div>
</li>
<li><p>If you already have downloaded SQL bundles or tracking log files, you
can use <code class="docutils literal notranslate"><span class="pre">simeon</span> <span class="pre">split</span></code> them up.</p></li>
</ul>
</section>
<section id="make-secondary-aggregated-tables">
<h1 id="make-secondary-aggregated-tables">Make secondary/aggregated tables<a class="headerlink" href="#make-secondary-aggregated-tables" title="Link to this heading">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">simeon</span></code> can generate secondary tables based on already loaded data.
Call <code class="docutils literal notranslate"><span class="pre">simeon</span> <span class="pre">report</span> <span class="pre">--help</span></code> for the expected positional and optional
arguments.</p>
<ul>
<li><p>Example: Make <code class="docutils literal notranslate"><span class="pre">person_course</span></code> for course ID <code class="docutils literal notranslate"><span class="pre">MITx/12.3x/1T2021</span></code></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a person course table for course ID MITx/12.3x/1T2021</span>
<span class="c1"># Provide the -g option to give a geolocation BigQuery table</span>
<span class="c1"># to fill the ip-to-location details in the generated person course table</span>
<span class="nv">COURSE</span><span class="o">=</span>MITx/12.3x/1T2021
simeon<span class="w"> </span>report<span class="w"> </span>-w<span class="w"> </span>-g<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">GCP_PROJECT_ID</span><span class="si">}</span><span class="s2">.geocode.geoip"</span><span class="w"> </span>-t<span class="w"> </span><span class="s2">"person_course"</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">GCP_PROJECT_ID</span><span class="si">}</span><span class="w"> </span>-S<span class="w"> </span><span class="si">${</span><span class="nv">SAFILE</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">COURSE</span><span class="si">}</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="notes">
<h1 id="notes">Notes:<a class="headerlink" href="#notes" title="Link to this heading">¶</a></h1>
<ol class="arabic simple">
<li><p>Please note that SQL bundles are quite large when split up, so
consider using the <code class="docutils literal notranslate"><span class="pre">-c</span></code> or <code class="docutils literal notranslate"><span class="pre">--courses</span></code> option when invoking
<code class="docutils literal notranslate"><span class="pre">simeon</span> <span class="pre">download</span> <span class="pre">-S</span></code> or <code class="docutils literal notranslate"><span class="pre">simeon</span> <span class="pre">split</span></code> to make sure that you
limit the splitting to a set of course IDs. You may also use the
<code class="docutils literal notranslate"><span class="pre">--clistings-file</span></code> option, which expects a txt file of course IDs;
one ID per line. If the aforementioned options are not used,
<code class="docutils literal notranslate"><span class="pre">simeon</span></code> may end up failing to complete the split operation due to
exhausted system resources (storage to be specific).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">simeon</span> <span class="pre">download</span></code> with file types <code class="docutils literal notranslate"><span class="pre">log</span></code> and <code class="docutils literal notranslate"><span class="pre">email</span></code> will both
download and decrypt the files matching the given criteria. If the
latter operations are successful, then the encrypted files are
deleted by default. This is to make sure that you don’t exhaust
storage resources. If you wish to keep those files, you can always
use the <code class="docutils literal notranslate"><span class="pre">--keep-encrypted</span></code> option that comes with
<code class="docutils literal notranslate"><span class="pre">simeon</span> <span class="pre">download</span></code> and <code class="docutils literal notranslate"><span class="pre">simeon</span> <span class="pre">split</span></code>. SQL bundles are only
downloaded (not decrypted). Their decryption is done during a
<code class="docutils literal notranslate"><span class="pre">split</span></code> operation.</p></li>
<li><p>Unless there is an unhandled exception (which should be reported as a
bug), <code class="docutils literal notranslate"><span class="pre">simeon</span></code> should, by default, print to the standard output
both information and errors encountered while processing your files.
You can capture those logs in a file by using the global option
<code class="docutils literal notranslate"><span class="pre">--log-file</span></code> and providing a destination file for the logs.</p></li>
<li><p>When using multi argument options like <code class="docutils literal notranslate"><span class="pre">--tables</span></code> or <code class="docutils literal notranslate"><span class="pre">--courses</span></code>,
you should try not to place them right before the expected positional
arguments. This will help the CLI parser not confuse your positional
arguments with table names (in the case of <code class="docutils literal notranslate"><span class="pre">--tables</span></code>) or course
IDs (when <code class="docutils literal notranslate"><span class="pre">--courses</span></code> is used).</p></li>
<li><p>Splitting tracking logs is a resource intensive process. The routine
that splits the logs generates a file for each course ID encountered.
If you happen to have more course IDs in your logs than the running
process can open operating system file descriptors, then <code class="docutils literal notranslate"><span class="pre">simeon</span></code>
will put away records it can’t save to disk for a second pass.
Putting away the records involves using more memory than normally
required. The second pass will only require one file descriptor at a
time, so it should be safe in terms of file descriptor limits. To
help <code class="docutils literal notranslate"><span class="pre">simeon</span></code> not have to do a second pass, you may increase the
file descriptor limits of processes from your shell by running
something like <code class="docutils literal notranslate"><span class="pre">ulimit</span> <span class="pre">-n</span> <span class="pre">2000</span></code> before calling <code class="docutils literal notranslate"><span class="pre">simeon</span> <span class="pre">split</span></code> on
Unix machines. For Windows users, you may have to dig into the
Windows Registries for a corresponding setting. This should tell your
OS kernel to allow OS processes to open up to 2000 file handles.</p></li>
<li><p>Care must be taken when using <code class="docutils literal notranslate"><span class="pre">simeon</span> <span class="pre">split</span></code> and <code class="docutils literal notranslate"><span class="pre">simeon</span> <span class="pre">push</span></code> to
make sure that the number of positional arguments passed does not
lead to the invoked command exceeding the maximum command-line length
allowed for arguments in a command. To avoid errors along those
lines, please consider passing the positional arguments as UNIX glob
patterns. For instance,
<code class="docutils literal notranslate"><span class="pre">simeon</span> <span class="pre">split</span> <span class="pre">--file-type</span> <span class="pre">log</span> <span class="pre">'data/TRACKING-LOGS/*/*.log.gz'</span></code>
tells <code class="docutils literal notranslate"><span class="pre">simeon</span></code> to expand the given glob pattern, instead of relying
on the shell to do it.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">report</span></code> subcommand relies on the presence of SQL query files
to parse and send to BigQuery to execute. Any errors arising from
executing the parsed queries will be shown to the end user through
the given log stream. While the <code class="docutils literal notranslate"><span class="pre">simeon</span></code> tool ships with query
files for most secondary/reporting tables that are based on the
<code class="docutils literal notranslate"><span class="pre">edx2bigquery</span></code> tool, an end user should be able to point <code class="docutils literal notranslate"><span class="pre">simeon</span></code>
to a different location with SQL query files by using the
<code class="docutils literal notranslate"><span class="pre">--query-dir</span></code> option that comes with <code class="docutils literal notranslate"><span class="pre">simeon</span> <span class="pre">report</span></code>.
Additionally, these query files can contain <a class="reference external" href="https://jinja.palletsprojects.com/en/latest/">jinja2
templated</a> SQL code.
Any mentioned variables within these templated queries can be passed
to <code class="docutils literal notranslate"><span class="pre">simeon</span> <span class="pre">report</span></code> by using the <code class="docutils literal notranslate"><span class="pre">--extra-args</span></code> option and passing
key-value pair items in the format
<code class="docutils literal notranslate"><span class="pre">var1=value1,var2=value2,var3=value3,...,var_n=value_n</span></code>. Further,
these key-value pair items can also be typed by using the format
<code class="docutils literal notranslate"><span class="pre">var1:i=value1,var2:s=value2,var3:f=value3,...,var_n:s=value_n</span></code>. In
this format, the type is appended to the key, separated by a colon.
The only supported scalar types, so far, are <code class="docutils literal notranslate"><span class="pre">s</span></code> for <code class="docutils literal notranslate"><span class="pre">str</span></code>, <code class="docutils literal notranslate"><span class="pre">i</span></code>
for <code class="docutils literal notranslate"><span class="pre">int</span></code>, and <code class="docutils literal notranslate"><span class="pre">f</span></code> for <code class="docutils literal notranslate"><span class="pre">float</span></code>. If any conversion errors occur
during value parsing, then those are shown to the end user, and the
query won’t get executed. Finally, if you wish to pass an <code class="docutils literal notranslate"><span class="pre">array</span></code>
or <code class="docutils literal notranslate"><span class="pre">list</span></code> to the template, you will need to repeat a key multiple
times. For instance, if you want to pass a list named <code class="docutils literal notranslate"><span class="pre">mylist</span></code>
containing the integers, you could write something like
<code class="docutils literal notranslate"><span class="pre">--extra-args</span> <span class="pre">mylist:i=1,mylist:i=2,mylist:i=3</span></code>. This means that
you’ll have a python <code class="docutils literal notranslate"><span class="pre">list</span></code> named <code class="docutils literal notranslate"><span class="pre">mylist</span></code> within your template,
and it should contain <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code>. You can also pass a JSON file
whose top-level objects are parsed as variables. Use a leading <code class="docutils literal notranslate"><span class="pre">@</span></code>
when passing a JSON file.</p></li>
</ol>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="index.html" title="Documentation for the simeon CLI tool"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> "Previous" </span> Documentation for the simeon CLI tool </span>
              </div>
            </a>
          
          
            <a href="api_intro.html" title="Components of the download package"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> "Next" </span> Components of the <code class="xref py py-class docutils literal notranslate"><span class="pre">download</span></code> package </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2021, MIT Institutional Research.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>